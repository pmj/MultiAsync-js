<!DOCTYPE html>
<html>
<head>
<title>7 - We can, 1/2</title>
<link rel="stylesheet" type="text/css" href="talk.css">
<link rel="next" href="8.html">
<link rel="prev" href="6.html">
</head>
<body>
<h1>We can, part 1</h1>
<div class="javascript"><ol><li class="li1"><div class="de1"><span class="kw2">function</span> AsyncHandler<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span></div></li>
<li class="li1"><div class="de1">&nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy0">!</span><span class="kw1">this</span> <span class="kw1">instanceof</span> AsyncHandler<span class="br0">&#41;</span> <span class="kw1">return</span> <span class="kw2">new</span> AsyncHandler<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1"><span class="br0">&#125;</span></div></li>
<li class="li1"><div class="de1">AsyncHandler.<span class="me1">prototype</span> <span class="sy0">=</span> <span class="br0">&#123;</span></div></li>
<li class="li2"><div class="de2">&nbsp; waiting<span class="sy0">:</span><span class="nu0">0</span><span class="sy0">,</span></div></li>
<li class="li1"><div class="de1">&nbsp; args<span class="sy0">:</span><span class="br0">&#91;</span><span class="br0">&#93;</span><span class="sy0">,</span></div></li>
<li class="li1"><div class="de1">&nbsp; next_idx<span class="sy0">:</span><span class="nu0">0</span><span class="sy0">,</span></div></li>
<li class="li1"><div class="de1">&nbsp; final_cb<span class="sy0">:</span><span class="kw2">null</span><span class="sy0">,</span></div></li>
<li class="li1"><div class="de1">&nbsp; final_cb_this<span class="sy0">:</span><span class="kw2">null</span><span class="sy0">,</span></div></li>
<li class="li2"><div class="de2">&nbsp;</div></li>
<li class="li1"><div class="de1">&nbsp; cb<span class="sy0">:</span> <span class="kw2">function</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="co2">/* ... */</span> <span class="br0">&#125;</span><span class="sy0">,</span></div></li>
<li class="li1"><div class="de1">&nbsp; </div></li>
<li class="li2"><div class="de2">&nbsp; <span class="co1">// signals that all callbacks have been produced, registers the completion function</span></div></li>
<li class="li1"><div class="de1">&nbsp; whenDone<span class="sy0">:</span> <span class="kw2">function</span><span class="br0">&#40;</span>fn<span class="sy0">,</span> this_obj<span class="br0">&#41;</span> <span class="br0">&#123;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">this</span>.<span class="me1">final_cb_this</span> <span class="sy0">=</span> this_obj <span class="sy0">||</span> <span class="kw1">this</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">this</span>.<span class="me1">final_cb</span> <span class="sy0">=</span> fn<span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">waiting</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">&#41;</span> <span class="br0">&#123;</span></div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; &nbsp; <span class="kw1">this</span>.<span class="me1">final_cb</span>.<span class="me1">apply</span><span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">final_cb_this</span><span class="sy0">,</span> <span class="kw1">this</span>.<span class="me1">args</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="br0">&#125;</span></div></li>
<li class="li1"><div class="de1">&nbsp; <span class="br0">&#125;</span></div></li>
<li class="li1"><div class="de1"><span class="br0">&#125;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
</ol></div>

</body></html>